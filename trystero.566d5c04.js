function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire94c2,n=r.register;n("1YF7P",function(t,n){e(t.exports,"joinRoom",function(){return r("7cIbn").joinRoom}),r("7cIbn")}),n("7cIbn",function(t,n){e(t.exports,"joinRoom",function(){return y});var i=r("fM65e"),s=r("heJnm"),o=r("5tvWL");let a={},l="EVENT",u=o.isBrowser&&(0,i.schnorr).utils.randomPrivateKey(),d=o.isBrowser&&(0,o.toHex)((0,i.schnorr).getPublicKey(u)),h={},c={},f=()=>Math.floor(Date.now()/1e3),p=async(e,t)=>{let r={kind:29333,content:t,pubkey:d,created_at:f(),tags:[["x",e]]},n=(0,o.toHex)(new Uint8Array(await crypto.subtle.digest("SHA-256",(0,o.encodeBytes)((0,o.toJson)([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])))));return(0,o.toJson)([l,{...r,id:n,sig:(0,o.toHex)(await (0,i.schnorr).sign(n,u))}])},m=(e,t)=>(h[e]=t,(0,o.toJson)(["REQ",e,{kinds:[29333],since:f(),"#x":[t]}])),g=e=>(delete h[e],(0,o.toJson)(["CLOSE",e])),y=(0,s.default)({init:e=>(0,o.getRelays)(e,b,5).map(e=>{let t=(0,o.makeSocket)(e,e=>{let[r,n,i,s]=(0,o.fromJson)(e);if(r!==l){let e=`${o.libName}: relay failure from ${t.url} - `;"NOTICE"===r?console.warn(e+n):"OK"!==r||i||console.warn(e+s);return}c[n]?.(h[n],i.content)});return a[e]=t,t.ready}),subscribe:(e,t,r,n)=>{let i=(0,o.genId)(64),s=(0,o.genId)(64);return c[i]=c[s]=(t,r)=>n(t,r,async(t,r)=>e.send(await p(t,r))),e.send(m(i,t)),e.send(m(s,r)),()=>{e.send(g(i)),e.send(g(s)),delete c[i],delete c[s]}},announce:async(e,t)=>e.send(await p(t,(0,o.toJson)({peerId:o.selfId})))});(0,o.socketGetter)(a);let b=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(e=>"wss://"+e)}),n("fM65e",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.encodeToCurve=e.exports.hashToCurve=e.exports.schnorr=e.exports.secp256k1=void 0;var n=r("lrsL3"),i=r("ebEok"),s=r("jop2u"),o=r("6pfYR"),a=r("kXwf6"),l=r("ebkGf"),u=r("fuwhd");let d=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),h=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),c=BigInt(1),f=BigInt(2),p=(e,t)=>(e+t/f)/t;function m(e){let t=BigInt(3),r=BigInt(6),n=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),l=BigInt(88),u=e*e*e%d,h=u*u*e%d,c=(0,a.pow2)(h,t,d)*h%d,p=(0,a.pow2)(c,t,d)*h%d,m=(0,a.pow2)(p,f,d)*u%d,y=(0,a.pow2)(m,n,d)*m%d,b=(0,a.pow2)(y,i,d)*y%d,_=(0,a.pow2)(b,o,d)*b%d,x=(0,a.pow2)(_,l,d)*_%d,w=(0,a.pow2)(x,o,d)*b%d,v=(0,a.pow2)(w,t,d)*h%d,E=(0,a.pow2)(v,s,d)*y%d,S=(0,a.pow2)(E,r,d)*u%d,C=(0,a.pow2)(S,f,d);if(!g.eql(g.sqr(C),e))throw Error("Cannot find square root");return C}let g=(0,a.Field)(d,void 0,void 0,{sqrt:m});e.exports.secp256k1=(0,s.createCurve)({a:BigInt(0),b:BigInt(7),Fp:g,n:h,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-c*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=BigInt("0x100000000000000000000000000000000"),s=p(t*e,h),o=p(-r*e,h),l=(0,a.mod)(e-s*t-o*n,h),u=(0,a.mod)(-s*r-o*t,h),d=l>i,f=u>i;if(d&&(l=h-l),f&&(u=h-u),l>i||u>i)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:l,k2neg:f,k2:u}}}},n.sha256);let y=BigInt(0),b={};function _(e,...t){let r=b[e];if(void 0===r){let t=(0,n.sha256)(Uint8Array.from(e,e=>e.charCodeAt(0)));r=(0,l.concatBytes)(t,t),b[e]=r}return(0,n.sha256)((0,l.concatBytes)(r,...t))}let x=e=>e.toRawBytes(!0).slice(1),w=e=>(0,l.numberToBytesBE)(e,32),v=e=>(0,a.mod)(e,d),E=e=>(0,a.mod)(e,h),S=e.exports.secp256k1.ProjectivePoint,C=(e,t,r)=>S.BASE.multiplyAndAddUnsafe(e,t,r);function T(t){let r=e.exports.secp256k1.utils.normPrivateKeyToScalar(t),n=S.fromPrivateKey(r);return{scalar:n.hasEvenY()?r:E(-r),bytes:x(n)}}function k(e){(0,l.aInRange)("x",e,c,d);let t=v(e*e),r=m(v(t*e+BigInt(7)));r%f!==y&&(r=v(-r));let n=new S(e,r,c);return n.assertValidity(),n}let A=l.bytesToNumberBE;function R(...e){return E(A(_("BIP0340/challenge",...e)))}function B(e,t,r){let n=(0,l.ensureBytes)("signature",e,64),i=(0,l.ensureBytes)("message",t),s=(0,l.ensureBytes)("publicKey",r,32);try{let e=k(A(s)),t=A(n.subarray(0,32));if(!(0,l.inRange)(t,c,d))return!1;let r=A(n.subarray(32,64));if(!(0,l.inRange)(r,c,h))return!1;let o=R(w(t),x(e),i),a=C(e,r,E(-o));if(!a||!a.hasEvenY()||a.toAffine().x!==t)return!1;return!0}catch(e){return!1}}e.exports.schnorr={getPublicKey:function(e){return T(e).bytes},sign:function(e,t,r=(0,i.randomBytes)(32)){let n=(0,l.ensureBytes)("message",e),{bytes:s,scalar:o}=T(t),a=w(o^A(_("BIP0340/aux",(0,l.ensureBytes)("auxRand",r,32)))),u=E(A(_("BIP0340/nonce",a,s,n)));if(u===y)throw Error("sign failed: k is zero");let{bytes:d,scalar:h}=T(u),c=R(d,s,n),f=new Uint8Array(64);if(f.set(d,0),f.set(w(E(h+c*o)),32),!B(f,n,s))throw Error("sign: Invalid signature produced");return f},verify:B,utils:{randomPrivateKey:e.exports.secp256k1.utils.randomPrivateKey,lift_x:k,pointToBytes:x,numberToBytesBE:l.numberToBytesBE,bytesToNumberBE:l.bytesToNumberBE,taggedHash:_,mod:a.mod}};let O=(0,o.isogenyMap)(g,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))),I=(0,u.mapToCurveSimpleSWU)(g,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:g.create(BigInt("-11"))}),N=(0,o.createHasher)(e.exports.secp256k1.ProjectivePoint,e=>{let{x:t,y:r}=I(g.create(e[0]));return O(t,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:g.ORDER,m:1,k:128,expand:"xmd",hash:n.sha256});e.exports.hashToCurve=N.hashToCurve,e.exports.encodeToCurve=N.encodeToCurve}),n("lrsL3",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.sha224=e.exports.sha256=e.exports.SHA256=void 0;var n=r("8Ud7P"),i=r("ebEok");let s=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),o=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),a=new Uint32Array(64);class l extends n.HashMD{constructor(){super(64,32,8,!1),this.A=0|o[0],this.B=0|o[1],this.C=0|o[2],this.D=0|o[3],this.E=0|o[4],this.F=0|o[5],this.G=0|o[6],this.H=0|o[7]}get(){let{A:e,B:t,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[e,t,r,n,i,s,o,a]}set(e,t,r,n,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)a[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=a[e-15],r=a[e-2],n=(0,i.rotr)(t,7)^(0,i.rotr)(t,18)^t>>>3,s=(0,i.rotr)(r,17)^(0,i.rotr)(r,19)^r>>>10;a[e]=s+a[e-7]+n+a[e-16]|0}let{A:r,B:o,C:l,D:u,E:d,F:h,G:c,H:f}=this;for(let e=0;e<64;e++){let t=f+((0,i.rotr)(d,6)^(0,i.rotr)(d,11)^(0,i.rotr)(d,25))+(0,n.Chi)(d,h,c)+s[e]+a[e]|0,p=((0,i.rotr)(r,2)^(0,i.rotr)(r,13)^(0,i.rotr)(r,22))+(0,n.Maj)(r,o,l)|0;f=c,c=h,h=d,d=u+t|0,u=l,l=o,o=r,r=t+p|0}r=r+this.A|0,o=o+this.B|0,l=l+this.C|0,u=u+this.D|0,d=d+this.E|0,h=h+this.F|0,c=c+this.G|0,f=f+this.H|0,this.set(r,o,l,u,d,h,c,f)}roundClean(){a.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}e.exports.SHA256=l;class u extends l{constructor(){super(),this.A=-0x3efa6128,this.B=0x367cd507,this.C=0x3070dd17,this.D=-0x8f1a6c7,this.E=-4191439,this.F=0x68581511,this.G=0x64f98fa7,this.H=-0x4105b05c,this.outputLen=28}}e.exports.sha256=(0,i.wrapConstructor)(()=>new l),e.exports.sha224=(0,i.wrapConstructor)(()=>new u)}),n("8Ud7P",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.HashMD=e.exports.Maj=e.exports.Chi=void 0;var n=r("kjkVj"),i=r("ebEok");e.exports.Chi=(e,t,r)=>e&t^~e&r,e.exports.Maj=(e,t,r)=>e&t^e&r^t&r;class s extends i.Hash{constructor(e,t,r,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,i.createView)(this.buffer)}update(e){(0,n.aexists)(this);let{view:t,buffer:r,blockLen:s}=this,o=(e=(0,i.toBytes)(e)).length;for(let n=0;n<o;){let a=Math.min(s-this.pos,o-n);if(a===s){let t=(0,i.createView)(e);for(;s<=o-n;n+=s)this.process(t,n);continue}r.set(e.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,n.aexists)(this),(0,n.aoutput)(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:s,isLE:o}=this,{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let e=a;e<s;e++)t[e]=0;(function(e,t,r,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,n);let i=BigInt(32),s=BigInt(0xffffffff),o=Number(r>>i&s),a=Number(r&s),l=n?4:0,u=n?0:4;e.setUint32(t+l,o,n),e.setUint32(t+u,a,n)})(r,s-8,BigInt(8*this.length),o),this.process(r,0);let l=(0,i.createView)(e),u=this.outputLen;if(u%4)throw Error("_sha2: outputLen should be aligned to 32bit");let d=u/4,h=this.get();if(d>h.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)l.setUint32(4*e,h[e],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return e.length=n,e.pos=o,e.finished=i,e.destroyed=s,n%t&&e.buffer.set(r),e}}e.exports.HashMD=s}),n("kjkVj",function(e,t){function r(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function n(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function i(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)}function s(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function o(e,t){n(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.anumber=r,e.exports.number=r,e.exports.abytes=n,e.exports.bytes=n,e.exports.ahash=i,e.exports.aexists=s,e.exports.aoutput=o,e.exports.default={number:r,bytes:n,hash:i,exists:s,output:o}}),n("ebEok",function(e,t){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.Hash=e.exports.nextTick=e.exports.byteSwapIfBE=e.exports.byteSwap=e.exports.isLE=e.exports.rotl=e.exports.rotr=e.exports.createView=e.exports.u32=e.exports.u8=void 0,e.exports.isBytes=function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name},e.exports.byteSwap32=function(t){for(let r=0;r<t.length;r++)t[r]=(0,e.exports.byteSwap)(t[r])},e.exports.bytesToHex=function(e){(0,i.abytes)(e);let t="";for(let r=0;r<e.length;r++)t+=s[e[r]];return t},e.exports.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=a(e.charCodeAt(i)),s=a(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n},e.exports.asyncLoop=u,e.exports.utf8ToBytes=d,e.exports.toBytes=h,e.exports.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];(0,i.abytes)(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r},e.exports.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("Options should be object or undefined");return Object.assign(e,t)},e.exports.wrapConstructor=function(e){let t=t=>e().update(h(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},e.exports.wrapConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(h(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.wrapXOFConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(h(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},e.exports.randomBytes=function(e=32){if(n.crypto&&"function"==typeof n.crypto.getRandomValues)return n.crypto.getRandomValues(new Uint8Array(e));if(n.crypto&&"function"==typeof n.crypto.randomBytes)return n.crypto.randomBytes(e);throw Error("crypto.getRandomValues must be defined")};var n=r("iHiEG"),i=r("kjkVj");e.exports.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),e.exports.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),e.exports.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),e.exports.rotr=(e,t)=>e<<32-t|e>>>t,e.exports.rotl=(e,t)=>e<<t|e>>>32-t>>>0,e.exports.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],e.exports.byteSwap=e=>e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255,e.exports.byteSwapIfBE=e.exports.isLE?e=>e:t=>(0,e.exports.byteSwap)(t);let s=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),o={_0:48,_9:57,A:65,F:70,a:97,f:102};function a(e){return e>=o._0&&e<=o._9?e-o._0:e>=o.A&&e<=o.F?e-(o.A-10):e>=o.a&&e<=o.f?e-(o.a-10):void 0}let l=async()=>{};async function u(t,r,n){let i=Date.now();for(let s=0;s<t;s++){n(s);let t=Date.now()-i;t>=0&&t<r||(await (0,e.exports.nextTick)(),i+=t)}}function d(e){if("string"!=typeof e)throw Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function h(e){return"string"==typeof e&&(e=d(e)),(0,i.abytes)(e),e}e.exports.nextTick=l,e.exports.Hash=class{clone(){return this._cloneInto()}}}),n("iHiEG",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.crypto=void 0,e.exports.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0}),n("jop2u",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.getHash=o,e.exports.createCurve=function(e,t){let r=t=>(0,s.weierstrass)({...e,...o(t)});return Object.freeze({...r(t),create:r})};var n=r("63hPu"),i=r("ebEok"),s=r("fuwhd");function o(e){return{hash:e,hmac:(t,...r)=>(0,n.hmac)(e,t,(0,i.concatBytes)(...r)),randomBytes:i.randomBytes}}}),n("63hPu",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.hmac=e.exports.HMAC=void 0;var n=r("kjkVj"),i=r("ebEok");class s extends i.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,n.ahash)(e);let r=(0,i.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let e=0;e<o.length;e++)o[e]^=54;this.iHash.update(o),this.oHash=e.create();for(let e=0;e<o.length;e++)o[e]^=106;this.oHash.update(o),o.fill(0)}update(e){return(0,n.aexists)(this),this.iHash.update(e),this}digestInto(e){(0,n.aexists)(this),(0,n.abytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=n,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}e.exports.HMAC=s,e.exports.hmac=(e,t,r)=>new s(e,t).update(r).digest(),e.exports.hmac.create=(e,t)=>new s(e,t)}),n("fuwhd",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.DER=void 0,e.exports.weierstrassPoints=p,e.exports.weierstrass=function(t){let r=function(e){let t=(0,n.validateBasic)(e);return s.validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(t),{Fp:a,n:l}=r,h=a.BYTES+1,c=2*a.BYTES+1;function f(e){return i.mod(e,l)}function m(e){return i.invert(e,l)}let{ProjectivePoint:g,normPrivateKeyToScalar:y,weierstrassEquation:b,isWithinCurveOrder:_}=p({...r,toBytes(e,t,r){let n=t.toAffine(),i=a.toBytes(n.x),o=s.concatBytes;return((0,s.abool)("isCompressed",r),r)?o(Uint8Array.from([t.hasEvenY()?2:3]),i):o(Uint8Array.from([4]),i,a.toBytes(n.y))},fromBytes(e){let t=e.length,r=e[0],n=e.subarray(1);if(t===h&&(2===r||3===r)){let e;let t=s.bytesToNumberBE(n);if(!s.inRange(t,d,a.ORDER))throw Error("Point is not on curve");let i=b(t);try{e=a.sqrt(i)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&r)==1!=((e&d)===d)&&(e=a.neg(e)),{x:t,y:e}}if(t===c&&4===r)return{x:a.fromBytes(n.subarray(0,a.BYTES)),y:a.fromBytes(n.subarray(a.BYTES,2*a.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+c+", got "+t)}}),x=e=>s.bytesToHex(s.numberToBytesBE(e,r.nByteLength)),w=(e,t,r)=>s.bytesToNumberBE(e.slice(t,r));class v{constructor(e,t,r){this.r=e,this.s=t,this.recovery=r,this.assertValidity()}static fromCompact(e){let t=r.nByteLength;return new v(w(e=(0,s.ensureBytes)("compactSignature",e,2*t),0,t),w(e,t,2*t))}static fromDER(t){let{r:r,s:n}=e.exports.DER.toSig((0,s.ensureBytes)("DER",t));return new v(r,n)}assertValidity(){s.aInRange("r",this.r,d,l),s.aInRange("s",this.s,d,l)}addRecoveryBit(e){return new v(this.r,this.s,e)}recoverPublicKey(e){let{r:t,s:n,recovery:i}=this,o=C((0,s.ensureBytes)("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");let l=2===i||3===i?t+r.n:t;if(l>=a.ORDER)throw Error("recovery id 2 or 3 invalid");let u=(1&i)==0?"02":"03",d=g.fromHex(u+x(l)),h=m(l),c=f(-o*h),p=f(n*h),y=g.BASE.multiplyAndAddUnsafe(d,c,p);if(!y)throw Error("point at infinify");return y.assertValidity(),y}hasHighS(){return this.s>l>>d}normalizeS(){return this.hasHighS()?new v(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return s.hexToBytes(this.toDERHex())}toDERHex(){return e.exports.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return s.hexToBytes(this.toCompactHex())}toCompactHex(){return x(this.r)+x(this.s)}}function E(e){let t=s.isBytes(e),r="string"==typeof e,n=(t||r)&&e.length;return t?n===h||n===c:r?n===2*h||n===2*c:e instanceof g}let S=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=s.bytesToNumberBE(e),n=8*e.length-r.nBitLength;return n>0?t>>BigInt(n):t},C=r.bits2int_modN||function(e){return f(S(e))},T=s.bitMask(r.nBitLength);function k(e){return s.aInRange("num < 2^"+r.nBitLength,e,u,T),s.numberToBytesBE(e,r.nByteLength)}let A={lowS:r.lowS,prehash:!1},R={lowS:r.lowS,prehash:!1};return g.BASE._setWindowSize(8),{CURVE:r,getPublicKey:function(e,t=!0){return g.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(E(e))throw Error("first arg must be private key");if(!E(t))throw Error("second arg must be public key");return g.fromHex(t).multiply(y(e)).toRawBytes(r)},sign:function(e,t,n=A){let{seed:i,k2sig:h}=function(e,t,n=A){if(["recovered","canonical"].some(e=>e in n))throw Error("sign() legacy options not supported");let{hash:i,randomBytes:h}=r,{lowS:c,prehash:p,extraEntropy:b}=n;null==c&&(c=!0),e=(0,s.ensureBytes)("msgHash",e),o(n),p&&(e=(0,s.ensureBytes)("prehashed msgHash",i(e)));let x=C(e),w=y(t),E=[k(w),k(x)];if(null!=b&&!1!==b){let e=!0===b?h(a.BYTES):b;E.push((0,s.ensureBytes)("extraEntropy",e))}return{seed:s.concatBytes(...E),k2sig:function(e){let t=S(e);if(!_(t))return;let r=m(t),n=g.BASE.multiply(t).toAffine(),i=f(n.x);if(i===u)return;let s=f(r*f(x+i*w));if(s===u)return;let o=(n.x===i?0:2)|Number(n.y&d),a=s;if(c&&s>l>>d)a=s>l>>d?f(-s):s,o^=1;return new v(i,a,o)}}}(e,t,n);return s.createHmacDrbg(r.hash.outputLen,r.nByteLength,r.hmac)(i,h)},verify:function(t,n,i,a=R){let l,u;n=(0,s.ensureBytes)("msgHash",n),i=(0,s.ensureBytes)("publicKey",i);let{lowS:d,prehash:h,format:c}=a;if(o(a),"strict"in a)throw Error("options.strict was renamed to lowS");if(void 0!==c&&"compact"!==c&&"der"!==c)throw Error("format must be compact or der");let p="string"==typeof t||s.isBytes(t),y=!p&&!c&&"object"==typeof t&&null!==t&&"bigint"==typeof t.r&&"bigint"==typeof t.s;if(!p&&!y)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(y&&(u=new v(t.r,t.s)),p){try{"compact"!==c&&(u=v.fromDER(t))}catch(t){if(!(t instanceof e.exports.DER.Err))throw t}u||"der"===c||(u=v.fromCompact(t))}l=g.fromHex(i)}catch(e){return!1}if(!u||d&&u.hasHighS())return!1;h&&(n=r.hash(n));let{r:b,s:_}=u,x=C(n),w=m(_),E=f(x*w),S=f(b*w),T=g.BASE.multiplyAndAddUnsafe(l,E,S)?.toAffine();return!!T&&f(T.x)===b},ProjectivePoint:g,Signature:v,utils:{isValidPrivateKey(e){try{return y(e),!0}catch(e){return!1}},normPrivateKeyToScalar:y,randomPrivateKey:()=>{let e=i.getMinHashLength(r.n);return i.mapHashToField(r.randomBytes(e),r.n)},precompute:(e=8,t=g.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}},e.exports.SWUFpSqrtRatio=m,e.exports.mapToCurveSimpleSWU=function(e,t){if(i.validateField(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let r=m(e,t.Z);if(!e.isOdd)throw Error("Fp.isOdd is not implemented!");return n=>{let i,s,o,a,l,u,d,h;i=e.sqr(n),i=e.mul(i,t.Z),s=e.sqr(i),s=e.add(s,i),o=e.add(s,e.ONE),o=e.mul(o,t.B),a=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),a=e.mul(a,t.A),s=e.sqr(o),u=e.sqr(a),l=e.mul(u,t.A),s=e.add(s,l),s=e.mul(s,o),u=e.mul(u,a),l=e.mul(u,t.B),s=e.add(s,l),d=e.mul(i,o);let{isValid:c,value:f}=r(s,u);h=e.mul(i,n),h=e.mul(h,f),d=e.cmov(d,o,c),h=e.cmov(h,f,c);let p=e.isOdd(n)===e.isOdd(h);return h=e.cmov(e.neg(h),h,p),{x:d=e.div(d,a),y:h}}};var n=r("4Kwii"),i=r("kXwf6"),s=(r("ebkGf"),r("ebkGf"));function o(e){void 0!==e.lowS&&(0,s.abool)("lowS",e.lowS),void 0!==e.prehash&&(0,s.abool)("prehash",e.prehash)}let{bytesToNumberBE:a,hexToBytes:l}=s;e.exports.DER={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(t,r)=>{let{Err:n}=e.exports.DER;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(1&r.length)throw new n("tlv.encode: unpadded data");let i=r.length/2,o=s.numberToHexUnpadded(i);if(o.length/2&128)throw new n("tlv.encode: long form length too big");let a=i>127?s.numberToHexUnpadded(o.length/2|128):"";return s.numberToHexUnpadded(t)+a+o+r},decode(t,r){let{Err:n}=e.exports.DER,i=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(r.length<2||r[i++]!==t)throw new n("tlv.decode: wrong tlv");let s=r[i++],o=0;if(128&s){let e=127&s;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");let t=r.subarray(i,i+e);if(t.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===t[0])throw new n("tlv.decode(long): zero leftmost byte");for(let e of t)o=o<<8|e;if(i+=e,o<128)throw new n("tlv.decode(long): not minimal encoding")}else o=s;let a=r.subarray(i,i+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:r.subarray(i+o)}}},_int:{encode(t){let{Err:r}=e.exports.DER;if(t<u)throw new r("integer: negative integers are not allowed");let n=s.numberToHexUnpadded(t);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new r("unexpected DER parsing assertion: unpadded hex");return n},decode(t){let{Err:r}=e.exports.DER;if(128&t[0])throw new r("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new r("invalid signature integer: unnecessary leading zero");return a(t)}},toSig(t){let{Err:r,_int:n,_tlv:i}=e.exports.DER,o="string"==typeof t?l(t):t;s.abytes(o);let{v:a,l:u}=i.decode(48,o);if(u.length)throw new r("invalid signature: left bytes after parsing");let{v:d,l:h}=i.decode(2,a),{v:c,l:f}=i.decode(2,h);if(f.length)throw new r("invalid signature: left bytes after parsing");return{r:n.decode(d),s:n.decode(c)}},hexFromSig(t){let{_tlv:r,_int:n}=e.exports.DER,i=r.encode(2,n.encode(t.r)),s=r.encode(2,n.encode(t.s));return r.encode(48,i+s)}};let u=BigInt(0),d=BigInt(1),h=BigInt(2),c=BigInt(3),f=BigInt(4);function p(e){let t=function(e){let t=(0,n.validateBasic)(e);s.validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:i,a:o}=t;if(r){if(!i.eql(o,i.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:r}=t,o=i.Field(t.n,t.nBitLength),a=t.toBytes||((e,t,n)=>{let i=t.toAffine();return s.concatBytes(Uint8Array.from([4]),r.toBytes(i.x),r.toBytes(i.y))}),l=t.fromBytes||(e=>{let t=e.subarray(1);return{x:r.fromBytes(t.subarray(0,r.BYTES)),y:r.fromBytes(t.subarray(r.BYTES,2*r.BYTES))}});function h(e){let{a:n,b:i}=t,s=r.sqr(e),o=r.mul(s,e);return r.add(r.add(o,r.mul(e,n)),i)}if(!r.eql(r.sqr(t.Gy),h(t.Gx)))throw Error("bad generator point: equation left != right");function f(e){let r;let{allowedPrivateKeyLengths:n,nByteLength:o,wrapPrivateKey:a,n:l}=t;if(n&&"bigint"!=typeof e){if(s.isBytes(e)&&(e=s.bytesToHex(e)),"string"!=typeof e||!n.includes(e.length))throw Error("invalid private key");e=e.padStart(2*o,"0")}try{r="bigint"==typeof e?e:s.bytesToNumberBE((0,s.ensureBytes)("private key",e,o))}catch(t){throw Error("invalid private key, expected hex or "+o+" bytes, got "+typeof e)}return a&&(r=i.mod(r,l)),s.aInRange("private key",r,d,l),r}function p(e){if(!(e instanceof y))throw Error("ProjectivePoint expected")}let m=(0,s.memoized)((e,t)=>{let{px:n,py:i,pz:s}=e;if(r.eql(s,r.ONE))return{x:n,y:i};let o=e.is0();null==t&&(t=o?r.ONE:r.inv(s));let a=r.mul(n,t),l=r.mul(i,t),u=r.mul(s,t);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(u,r.ONE))throw Error("invZ was invalid");return{x:a,y:l}}),g=(0,s.memoized)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!r.is0(e.py))return;throw Error("bad point: ZERO")}let{x:n,y:i}=e.toAffine();if(!r.isValid(n)||!r.isValid(i))throw Error("bad point: x or y not FE");let s=r.sqr(i),o=h(n);if(!r.eql(s,o))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class y{constructor(e,t,n){if(this.px=e,this.py=t,this.pz=n,null==e||!r.isValid(e))throw Error("x required");if(null==t||!r.isValid(t))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required");Object.freeze(this)}static fromAffine(e){let{x:t,y:n}=e||{};if(!e||!r.isValid(t)||!r.isValid(n))throw Error("invalid affine point");if(e instanceof y)throw Error("projective point not allowed");let i=e=>r.eql(e,r.ZERO);return i(t)&&i(n)?y.ZERO:new y(t,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=r.invertBatch(e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(y.fromAffine)}static fromHex(e){let t=y.fromAffine(l((0,s.ensureBytes)("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return y.BASE.multiply(f(e))}static msm(e,t){return(0,n.pippenger)(y,o,e,t)}_setWindowSize(e){_.setWindowSize(this,e)}assertValidity(){g(this)}hasEvenY(){let{y:e}=this.toAffine();if(r.isOdd)return!r.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){p(e);let{px:t,py:n,pz:i}=this,{px:s,py:o,pz:a}=e,l=r.eql(r.mul(t,a),r.mul(s,i)),u=r.eql(r.mul(n,a),r.mul(o,i));return l&&u}negate(){return new y(this.px,r.neg(this.py),this.pz)}double(){let{a:e,b:n}=t,i=r.mul(n,c),{px:s,py:o,pz:a}=this,l=r.ZERO,u=r.ZERO,d=r.ZERO,h=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),m=r.mul(s,o);return m=r.add(m,m),d=r.mul(s,a),d=r.add(d,d),l=r.mul(e,d),u=r.mul(i,p),u=r.add(l,u),l=r.sub(f,u),u=r.add(f,u),u=r.mul(l,u),l=r.mul(m,l),d=r.mul(i,d),p=r.mul(e,p),m=r.sub(h,p),m=r.mul(e,m),m=r.add(m,d),d=r.add(h,h),h=r.add(d,h),h=r.add(h,p),h=r.mul(h,m),u=r.add(u,h),p=r.mul(o,a),p=r.add(p,p),h=r.mul(p,m),l=r.sub(l,h),d=r.mul(p,f),d=r.add(d,d),new y(l,u,d=r.add(d,d))}add(e){p(e);let{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=e,u=r.ZERO,d=r.ZERO,h=r.ZERO,f=t.a,m=r.mul(t.b,c),g=r.mul(n,o),b=r.mul(i,a),_=r.mul(s,l),x=r.add(n,i),w=r.add(o,a);x=r.mul(x,w),w=r.add(g,b),x=r.sub(x,w),w=r.add(n,s);let v=r.add(o,l);return w=r.mul(w,v),v=r.add(g,_),w=r.sub(w,v),v=r.add(i,s),u=r.add(a,l),v=r.mul(v,u),u=r.add(b,_),v=r.sub(v,u),h=r.mul(f,w),u=r.mul(m,_),h=r.add(u,h),u=r.sub(b,h),h=r.add(b,h),d=r.mul(u,h),b=r.add(g,g),b=r.add(b,g),_=r.mul(f,_),w=r.mul(m,w),b=r.add(b,_),_=r.sub(g,_),_=r.mul(f,_),w=r.add(w,_),g=r.mul(b,w),d=r.add(d,g),g=r.mul(v,w),u=r.mul(x,u),u=r.sub(u,g),g=r.mul(x,b),h=r.mul(v,h),new y(u,d,h=r.add(h,g))}subtract(e){return this.add(e.negate())}is0(){return this.equals(y.ZERO)}wNAF(e){return _.wNAFCached(this,e,y.normalizeZ)}multiplyUnsafe(e){let{endo:n,n:i}=t;s.aInRange("scalar",e,u,i);let o=y.ZERO;if(e===u)return o;if(this.is0()||e===d)return this;if(!n||_.hasPrecomputes(this))return _.wNAFCachedUnsafe(this,e,y.normalizeZ);let{k1neg:a,k1:l,k2neg:h,k2:c}=n.splitScalar(e),f=o,p=o,m=this;for(;l>u||c>u;)l&d&&(f=f.add(m)),c&d&&(p=p.add(m)),m=m.double(),l>>=d,c>>=d;return a&&(f=f.negate()),h&&(p=p.negate()),p=new y(r.mul(p.px,n.beta),p.py,p.pz),f.add(p)}multiply(e){let n,i;let{endo:o,n:a}=t;if(s.aInRange("scalar",e,d,a),o){let{k1neg:t,k1:s,k2neg:a,k2:l}=o.splitScalar(e),{p:u,f:d}=this.wNAF(s),{p:h,f:c}=this.wNAF(l);u=_.constTimeNegate(t,u),h=_.constTimeNegate(a,h),h=new y(r.mul(h.px,o.beta),h.py,h.pz),n=u.add(h),i=d.add(c)}else{let{p:t,f:r}=this.wNAF(e);n=t,i=r}return y.normalizeZ([n,i])[0]}multiplyAndAddUnsafe(e,t,r){let n=y.BASE,i=(e,t)=>t!==u&&t!==d&&e.equals(n)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,r));return s.is0()?void 0:s}toAffine(e){return m(this,e)}isTorsionFree(){let{h:e,isTorsionFree:r}=t;if(e===d)return!0;if(r)return r(y,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:r}=t;return e===d?this:r?r(y,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return(0,s.abool)("isCompressed",e),this.assertValidity(),a(y,this,e)}toHex(e=!0){return(0,s.abool)("isCompressed",e),s.bytesToHex(this.toRawBytes(e))}}y.BASE=new y(t.Gx,t.Gy,r.ONE),y.ZERO=new y(r.ZERO,r.ONE,r.ZERO);let b=t.nBitLength,_=(0,n.wNAF)(y,t.endo?Math.ceil(b/2):b);return{CURVE:t,ProjectivePoint:y,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:function(e){return s.inRange(e,d,t.n)}}}function m(e,t){let r=e.ORDER,n=u;for(let e=r-d;e%h===u;e/=h)n+=d;let i=n,s=h<<i-d-d,o=s*h,a=(r-d)/o,l=(a-d)/h,p=o-d,m=e.pow(t,a),g=e.pow(t,(a+d)/h),y=(t,r)=>{let n=m,o=e.pow(r,p),a=e.sqr(o);a=e.mul(a,r);let u=e.mul(t,a);u=e.pow(u,l),u=e.mul(u,o),o=e.mul(u,r),a=e.mul(u,t);let c=e.mul(a,o);u=e.pow(c,s);let f=e.eql(u,e.ONE);o=e.mul(a,g),u=e.mul(c,n),a=e.cmov(o,a,f),c=e.cmov(u,c,f);for(let t=i;t>d;t--){let r=t-h;r=h<<r-d;let i=e.pow(c,r),s=e.eql(i,e.ONE);o=e.mul(a,n),n=e.mul(n,n),i=e.mul(c,n),a=e.cmov(o,a,s),c=e.cmov(i,c,s)}return{isValid:f,value:a}};if(e.ORDER%f===c){let r=(e.ORDER-c)/f,n=e.sqrt(e.neg(t));y=(t,i)=>{let s=e.sqr(i),o=e.mul(t,i);s=e.mul(s,o);let a=e.pow(s,r);a=e.mul(a,o);let l=e.mul(a,n),u=e.mul(e.sqr(a),i),d=e.eql(u,t),h=e.cmov(l,a,d);return{isValid:d,value:h}}}return y}}),n("4Kwii",function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.wNAF=function(e,t){return{constTimeNegate:a,hasPrecomputes:e=>1!==p(e),unsafeLadder(t,r,n=e.ZERO){let i=t;for(;r>s;)r&o&&(n=n.add(i)),i=i.double(),r>>=o;return n},precomputeWindow(e,r){let{windows:n,windowSize:i}=u(r,t),s=[],o=e,a=o;for(let e=0;e<n;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(r,n,i){let{windows:s,windowSize:l}=u(r,t),d=e.ZERO,h=e.BASE,c=BigInt(2**r-1),f=2**r,p=BigInt(r);for(let e=0;e<s;e++){let t=e*l,r=Number(i&c);i>>=p,r>l&&(r-=f,i+=o);let s=t+Math.abs(r)-1,u=e%2!=0,m=r<0;0===r?h=h.add(a(u,n[t])):d=d.add(a(m,n[s]))}return{p:d,f:h}},wNAFUnsafe(r,n,i,a=e.ZERO){let{windows:l,windowSize:d}=u(r,t),h=BigInt(2**r-1),c=2**r,f=BigInt(r);for(let e=0;e<l;e++){let t=e*d;if(i===s)break;let r=Number(i&h);if(i>>=f,r>d&&(r-=c,i+=o),0===r)continue;let l=n[t+Math.abs(r)-1];r<0&&(l=l.negate()),a=a.add(l)}return a},getPrecomputes(e,t,r){let n=c.get(t);return n||(n=this.precomputeWindow(t,e),1!==e&&c.set(t,r(n))),n},wNAFCached(e,t,r){let n=p(e);return this.wNAF(n,this.getPrecomputes(n,e,r),t)},wNAFCachedUnsafe(e,t,r,n){let i=p(e);return 1===i?this.unsafeLadder(e,t,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),t,n)},setWindowSize(e,r){l(r,t),f.set(e,r),c.delete(e)}}},t.pippenger=function(e,t,r,n){if(d(r,e),h(n,t),r.length!==n.length)throw Error("arrays of points and scalars must have equal length");let s=e.ZERO,o=(0,i.bitLen)(BigInt(r.length)),a=o>12?o-3:o>4?o-2:o?2:1,l=(1<<a)-1,u=Array(l+1).fill(s),c=Math.floor((t.BITS-1)/a)*a,f=s;for(let e=c;e>=0;e-=a){u.fill(s);for(let t=0;t<n.length;t++){let i=Number(n[t]>>BigInt(e)&BigInt(l));u[i]=u[i].add(r[t])}let t=s;for(let e=u.length-1,r=s;e>0;e--)r=r.add(u[e]),t=t.add(r);if(f=f.add(t),0!==e)for(let e=0;e<a;e++)f=f.double()}return f},t.precomputeMSMUnsafe=function(e,t,r,n){l(n,t.BITS),d(r,e);let i=e.ZERO,s=2**n-1,o=Math.ceil(t.BITS/n),a=BigInt((1<<n)-1),u=r.map(e=>{let t=[];for(let r=0,n=e;r<s;r++)t.push(n),n=n.add(e);return t});return e=>{if(h(e,t),e.length>r.length)throw Error("array of scalars must be smaller than array of points");let s=i;for(let t=0;t<o;t++){if(s!==i)for(let e=0;e<n;e++)s=s.double();let r=BigInt(o*n-(t+1)*n);for(let t=0;t<e.length;t++){let n=Number(e[t]>>r&a);n&&(s=s.add(u[t][n-1]))}}return s}},t.validateBasic=function(e){return(0,n.validateField)(e.Fp),(0,i.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,n.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})};var n=r("kXwf6"),i=r("ebkGf");let s=BigInt(0),o=BigInt(1);function a(e,t){let r=t.negate();return e?r:t}function l(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function u(e,t){return l(e,t),{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}function d(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})}function h(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}let c=new WeakMap,f=new WeakMap;function p(e){return f.get(e)||1}}),n("kXwf6",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.isNegativeLE=void 0,e.exports.mod=h,e.exports.pow=c,e.exports.pow2=function(e,t,r){let n=e;for(;t-- >i;)n*=n,n%=r;return n},e.exports.invert=f,e.exports.tonelliShanks=p,e.exports.FpSqrt=m,e.exports.validateField=function(e){let t=g.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});return(0,n.validateObject)(e,t)},e.exports.FpPow=y,e.exports.FpInvertBatch=b,e.exports.FpDiv=function(e,t,r){return e.mul(t,"bigint"==typeof r?f(r,e.ORDER):e.inv(r))},e.exports.FpLegendre=_,e.exports.FpIsSquare=function(e){let t=_(e.ORDER);return r=>{let n=t(e,r);return e.eql(n,e.ZERO)||e.eql(n,e.ONE)}},e.exports.nLength=x,e.exports.Field=function(e,t,r=!1,o={}){let a;if(e<=i)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:l,nByteLength:u}=x(e,t);if(u>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let d=Object.freeze({ORDER:e,BITS:l,BYTES:u,MASK:(0,n.bitMask)(l),ZERO:i,ONE:s,create:t=>h(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return i<=t&&t<e},is0:e=>e===i,isOdd:e=>(e&s)===s,neg:t=>h(-t,e),eql:(e,t)=>e===t,sqr:t=>h(t*t,e),add:(t,r)=>h(t+r,e),sub:(t,r)=>h(t-r,e),mul:(t,r)=>h(t*r,e),pow:(e,t)=>y(d,e,t),div:(t,r)=>h(t*f(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>f(t,e),sqrt:o.sqrt||(t=>(a||(a=m(e)),a(d,t))),invertBatch:e=>b(d,e),cmov:(e,t,r)=>r?t:e,toBytes:e=>r?(0,n.numberToBytesLE)(e,u):(0,n.numberToBytesBE)(e,u),fromBytes:e=>{if(e.length!==u)throw Error("Field.fromBytes: expected "+u+" bytes, got "+e.length);return r?(0,n.bytesToNumberLE)(e):(0,n.bytesToNumberBE)(e)}});return Object.freeze(d)},e.exports.FpSqrtOdd=function(e,t){if(!e.isOdd)throw Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)},e.exports.FpSqrtEven=function(e,t){if(!e.isOdd)throw Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r},e.exports.hashToPrivateScalar=function(e,t,r=!1){let i=(e=(0,n.ensureBytes)("privateHash",e)).length,o=x(t).nByteLength+8;if(o<24||i<o||i>1024)throw Error("hashToPrivateScalar: expected "+o+"-1024 bytes of input, got "+i);return h(r?(0,n.bytesToNumberLE)(e):(0,n.bytesToNumberBE)(e),t-s)+s},e.exports.getFieldBytesLength=w,e.exports.getMinHashLength=v,e.exports.mapHashToField=function(e,t,r=!1){let i=e.length,o=w(t),a=v(t);if(i<16||i<a||i>1024)throw Error("expected "+a+"-1024 bytes of input, got "+i);let l=h(r?(0,n.bytesToNumberBE)(e):(0,n.bytesToNumberLE)(e),t-s)+s;return r?(0,n.numberToBytesLE)(l,o):(0,n.numberToBytesBE)(l,o)};var n=r("ebkGf");let i=BigInt(0),s=BigInt(1),o=BigInt(2),a=BigInt(3),l=BigInt(4),u=BigInt(5),d=BigInt(8);function h(e,t){let r=e%t;return r>=i?r:t+r}function c(e,t,r){if(t<i)throw Error("invalid exponent, negatives unsupported");if(r<=i)throw Error("invalid modulus");if(r===s)return i;let n=s;for(;t>i;)t&s&&(n=n*e%r),e=e*e%r,t>>=s;return n}function f(e,t){if(e===i)throw Error("invert: expected non-zero number");if(t<=i)throw Error("invert: expected positive modulus, got "+t);let r=h(e,t),n=t,o=i,a=s,l=s,u=i;for(;r!==i;){let e=n/r,t=n%r,i=o-l*e,s=a-u*e;n=r,r=t,o=l,a=u,l=i,u=s}if(n!==s)throw Error("invert: does not exist");return h(o,t)}function p(e){let t,r,n;let a=(e-s)/o;for(t=e-s,r=0;t%o===i;t/=o,r++);for(n=o;n<e&&c(n,a,e)!==e-s;n++)if(n>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===r){let t=(e+s)/l;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}let u=(t+s)/o;return function(e,i){if(e.pow(i,a)===e.neg(e.ONE))throw Error("Cannot find square root");let o=r,l=e.pow(e.mul(e.ONE,n),t),d=e.pow(i,u),h=e.pow(i,t);for(;!e.eql(h,e.ONE);){if(e.eql(h,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(h);t<o&&!e.eql(r,e.ONE);t++)r=e.sqr(r);let r=e.pow(l,s<<BigInt(o-t-1));l=e.sqr(r),d=e.mul(d,r),h=e.mul(h,l),o=t}return d}}function m(e){if(e%l===a){let t=(e+s)/l;return function(e,r){let n=e.pow(r,t);if(!e.eql(e.sqr(n),r))throw Error("Cannot find square root");return n}}if(e%d===u){let t=(e-u)/d;return function(e,r){let n=e.mul(r,o),i=e.pow(n,t),s=e.mul(r,i),a=e.mul(e.mul(s,o),i),l=e.mul(s,e.sub(a,e.ONE));if(!e.eql(e.sqr(l),r))throw Error("Cannot find square root");return l}}return p(e)}e.exports.isNegativeLE=(e,t)=>(h(e,t)&s)===s;let g=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function y(e,t,r){if(r<i)throw Error("invalid exponent, negatives unsupported");if(r===i)return e.ONE;if(r===s)return t;let n=e.ONE,o=t;for(;r>i;)r&s&&(n=e.mul(n,o)),o=e.sqr(o),r>>=s;return n}function b(e,t){let r=Array(t.length),n=t.reduce((t,n,i)=>e.is0(n)?t:(r[i]=t,e.mul(t,n)),e.ONE),i=e.inv(n);return t.reduceRight((t,n,i)=>e.is0(n)?t:(r[i]=e.mul(t,r[i]),e.mul(t,n)),i),r}function _(e){let t=(e-s)/o;return(e,r)=>e.pow(r,t)}function x(e,t){let r=void 0!==t?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function w(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function v(e){let t=w(e);return t+Math.ceil(t/2)}}),n("ebkGf",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.notImplemented=e.exports.bitMask=void 0,e.exports.isBytes=s,e.exports.abytes=o,e.exports.abool=function(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)},e.exports.bytesToHex=l,e.exports.numberToHexUnpadded=u,e.exports.hexToNumber=d,e.exports.hexToBytes=f,e.exports.bytesToNumberBE=function(e){return d(l(e))},e.exports.bytesToNumberLE=function(e){return o(e),d(l(Uint8Array.from(e).reverse()))},e.exports.numberToBytesBE=p,e.exports.numberToBytesLE=function(e,t){return p(e,t).reverse()},e.exports.numberToVarBytesBE=function(e){return f(u(e))},e.exports.ensureBytes=function(e,t,r){let n;if("string"==typeof t)try{n=f(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(s(t))n=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let i=n.length;if("number"==typeof r&&i!==r)throw Error(e+" of length "+r+" expected, got "+i);return n},e.exports.concatBytes=m,e.exports.equalBytes=function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},e.exports.utf8ToBytes=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))},e.exports.inRange=y,e.exports.aInRange=function(e,t,r,n){if(!y(t,r,n))throw Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)},e.exports.bitLen=function(e){let t;for(t=0;e>r;e>>=n,t+=1);return t},e.exports.bitGet=function(e,t){return e>>BigInt(t)&n},e.exports.bitSet=function(e,t,i){return e|(i?n:r)<<BigInt(t)},e.exports.createHmacDrbg=function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=b(e),i=b(e),s=0,o=()=>{n.fill(1),i.fill(0),s=0},a=(...e)=>r(i,n,...e),l=(e=b())=>{i=a(_([0]),e),n=a(),0!==e.length&&(i=a(_([1]),e),n=a())},u=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=a()).slice();r.push(t),e+=n.length}return m(...r)};return(e,t)=>{let r;for(o(),l(e);!(r=t(u()));)l();return o(),r}},e.exports.validateObject=function(e,t,r={}){let n=(t,r,n)=>{let i=x[r];if("function"!=typeof i)throw Error("invalid validator function");let s=e[t];if((!n||void 0!==s)&&!i(s,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+s)};for(let[e,r]of Object.entries(t))n(e,r,!1);for(let[e,t]of Object.entries(r))n(e,t,!0);return e},e.exports.memoized=function(e){let t=new WeakMap;return(r,...n)=>{let i=t.get(r);if(void 0!==i)return i;let s=e(r,...n);return t.set(r,s),s}};/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */let r=BigInt(0),n=BigInt(1),i=BigInt(2);function s(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function o(e){if(!s(e))throw Error("Uint8Array expected")}let a=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function l(e){o(e);let t="";for(let r=0;r<e.length;r++)t+=a[e[r]];return t}function u(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function d(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?r:BigInt("0x"+e)}let h={_0:48,_9:57,A:65,F:70,a:97,f:102};function c(e){return e>=h._0&&e<=h._9?e-h._0:e>=h.A&&e<=h.F?e-(h.A-10):e>=h.a&&e<=h.f?e-(h.a-10):void 0}function f(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=c(e.charCodeAt(i)),s=c(e.charCodeAt(i+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+s}return n}function p(e,t){return f(e.toString(16).padStart(2*t,"0"))}function m(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];o(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}let g=e=>"bigint"==typeof e&&r<=e;function y(e,t,r){return g(e)&&g(t)&&g(r)&&t<=e&&e<r}e.exports.bitMask=e=>(i<<BigInt(e-1))-n;let b=e=>new Uint8Array(e),_=e=>Uint8Array.from(e),x={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||s(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};e.exports.notImplemented=()=>{throw Error("not implemented")}}),n("6pfYR",function(e,t){Object.defineProperty(e.exports,"__esModule",{value:!0}),e.exports.expand_message_xmd=l,e.exports.expand_message_xof=u,e.exports.hash_to_field=d,e.exports.isogenyMap=function(e,t){let r=t.map(e=>Array.from(e).reverse());return(t,n)=>{let[i,s,o,a]=r.map(r=>r.reduce((r,n)=>e.add(e.mul(r,t),n)));return t=e.div(i,s),n=e.mul(n,e.div(o,a)),{x:t,y:n}}},e.exports.createHasher=function(e,t,r){if("function"!=typeof t)throw Error("mapToCurve() must be defined");return{hashToCurve(n,i){let s=d(n,2,{...r,DST:r.DST,...i}),o=e.fromAffine(t(s[0])),a=e.fromAffine(t(s[1])),l=o.add(a).clearCofactor();return l.assertValidity(),l},encodeToCurve(n,i){let s=d(n,1,{...r,DST:r.encodeDST,...i}),o=e.fromAffine(t(s[0])).clearCofactor();return o.assertValidity(),o},mapToCurve(r){if(!Array.isArray(r))throw Error("mapToCurve: expected array of bigints");for(let e of r)if("bigint"!=typeof e)throw Error("mapToCurve: expected array of bigints");let n=e.fromAffine(t(r)).clearCofactor();return n.assertValidity(),n}}};var n=r("kXwf6"),i=r("ebkGf");let s=i.bytesToNumberBE;function o(e,t){if(a(e),a(t),e<0||e>=1<<8*t)throw Error("invalid I2OSP input: "+e);let r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=255&e,e>>>=8;return new Uint8Array(r)}function a(e){if(!Number.isSafeInteger(e))throw Error("number expected")}function l(e,t,r,n){(0,i.abytes)(e),(0,i.abytes)(t),a(r),t.length>255&&(t=n((0,i.concatBytes)((0,i.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));let{outputLen:s,blockLen:l}=n,u=Math.ceil(r/s);if(r>65535||u>255)throw Error("expand_message_xmd: invalid lenInBytes");let d=(0,i.concatBytes)(t,o(t.length,1)),h=o(0,l),c=o(r,2),f=Array(u),p=n((0,i.concatBytes)(h,e,c,o(0,1),d));f[0]=n((0,i.concatBytes)(p,o(1,1),d));for(let e=1;e<=u;e++){let t=[function(e,t){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}(p,f[e-1]),o(e+1,1),d];f[e]=n((0,i.concatBytes)(...t))}return(0,i.concatBytes)(...f).slice(0,r)}function u(e,t,r,n,s){if((0,i.abytes)(e),(0,i.abytes)(t),a(r),t.length>255){let e=Math.ceil(2*n/8);t=s.create({dkLen:e}).update((0,i.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw Error("expand_message_xof: invalid lenInBytes");return s.create({dkLen:r}).update(e).update(o(r,2)).update(t).update(o(t.length,1)).digest()}function d(e,t,r){let o;(0,i.validateObject)(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});let{p:d,k:h,m:c,hash:f,expand:p,DST:m}=r;(0,i.abytes)(e),a(t);let g="string"==typeof m?(0,i.utf8ToBytes)(m):m,y=Math.ceil((d.toString(2).length+h)/8),b=t*c*y;if("xmd"===p)o=l(e,g,b,f);else if("xof"===p)o=u(e,g,b,h,f);else if("_internal_pass"===p)o=e;else throw Error('expand must be "xmd" or "xof"');let _=Array(t);for(let e=0;e<t;e++){let t=Array(c);for(let r=0;r<c;r++){let i=y*(r+e*c),a=o.subarray(i,i+y);t[r]=(0,n.mod)(s(a),d)}_[e]=t}return _}}),n("heJnm",function(t,n){e(t.exports,"default",function(){return l});var i=r("h9mfh"),s=r("hZk0n"),o=r("9cqsZ"),a=r("5tvWL"),l=({init:e,subscribe:t,announce:r})=>{let n,l,u;let d={},h=!1;return(c,f,p)=>{let{appId:m}=c;if(d[m]?.[f])return d[m][f];let g={},y={},b=(0,a.topicPath)(a.libName,m,f),_=(0,i.sha1)(b),x=(0,i.sha1)((0,a.topicPath)(b,a.selfId)),w=(0,i.genKey)(c.password||"",m,f),v=e=>async t=>({type:t.type,sdp:await e(w,t.sdp)}),E=v(i.decrypt),S=v(i.encrypt),C=()=>(0,s.default)(!0,c.rtcConfig),T=(e,t,r)=>{if(y[t]){y[t]!==e&&e.destroy();return}y[t]=e,P(e,t),g[t]?.forEach((e,t)=>{t!==r&&e.destroy()}),delete g[t]},k=(e,t)=>{y[t]===e&&delete y[t]},A=(e,t)=>{if(y[e])return;let r=g[e]?.[t];r&&(delete g[e][t],r.destroy())},R=e=>(l.push(...(0,a.alloc)(e,C)),(0,a.all)(l.splice(0,e).map(e=>e.offerPromise.then(S).then(t=>({peer:e,offer:t}))))),B=(e,t)=>p?.({error:`incorrect password (${c.password}) when decrypting ${t}`,appId:m,peerId:e,roomId:f}),O=e=>async(t,r,n)=>{let[o,l]=await (0,a.all)([_,x]);if(t!==o&&t!==l)return;let{peerId:u,offer:d,answer:h,peer:f}="string"==typeof r?(0,a.fromJson)(r):r;if(u!==a.selfId&&!y[u]){if(!u||d||h){if(d){let t;if(g[u]?.[e]&&a.selfId>u)return;let r=(0,s.default)(!1,c.rtcConfig);r.setHandlers({connect:()=>T(r,u,e),close:()=>k(r,u)});try{t=await E(d)}catch(e){B(u,"offer");return}if(r.isDead)return;let[o,l]=await (0,a.all)([(0,i.sha1)((0,a.topicPath)(b,u)),r.signal(t)]);n(o,(0,a.toJson)({peerId:a.selfId,answer:await S(l)}))}else if(h){let t;try{t=await E(h)}catch(e){B(u,"answer");return}if(f)f.setHandlers({connect:()=>T(f,u,e),close:()=>k(f,u)}),f.signal(t);else{let r=g[u]?.[e];r&&!r.isDead&&r.signal(t)}}}else{if(g[u]?.[e])return;let[[{peer:t,offer:r}],s]=await (0,a.all)([R(1),(0,i.sha1)((0,a.topicPath)(b,u))]);g[u]||=[],g[u][e]=t,setTimeout(()=>A(u,e),.9*I[e]),t.setHandlers({connect:()=>T(t,u,e),close:()=>k(t,u)}),n(s,(0,a.toJson)({peerId:a.selfId,offer:r}))}}};if(!c)throw(0,a.mkErr)("requires a config map as the first argument");if(!m&&!c.firebaseApp)throw(0,a.mkErr)("config map is missing appId field");if(!f)throw(0,a.mkErr)("roomId argument required");if(!h){let t=e(c);l=(0,a.alloc)(20,C),n=Array.isArray(t)?t:[t],h=!0,u=setInterval(()=>l=l.filter(e=>{let t=Date.now()-e.created<57333;return t||e.destroy(),t}),59052.99)}let I=n.map(()=>5333),N=[],L=n.map(async(e,r)=>t(await e,await _,await x,O(r),R));(0,a.all)([_,x]).then(([e,t])=>{let i=async(n,s)=>{let o=await r(n,e,t);"number"==typeof o&&(I[s]=o),N[s]=setTimeout(()=>i(n,s),I[s])};L.forEach(async(e,t)=>{await e,i(await n[t],t)})});let P=a.noOp;return d[m]||={},d[m][f]=(0,o.default)(e=>P=e,e=>delete y[e],()=>{delete d[m][f],N.forEach(clearTimeout),L.forEach(async e=>(await e)()),clearInterval(u)})}}}),n("h9mfh",function(t,n){e(t.exports,"sha1",function(){return u}),e(t.exports,"genKey",function(){return d}),e(t.exports,"encrypt",function(){return h}),e(t.exports,"decrypt",function(){return c});var i=r("5tvWL");let s="AES-GCM",o={},a=e=>btoa(String.fromCharCode.apply(null,new Uint8Array(e))),l=e=>{let t=atob(e);return new Uint8Array(t.length).map((e,r)=>t.charCodeAt(r)).buffer},u=async e=>{if(o[e])return o[e];let t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",(0,i.encodeBytes)(e)))).map(e=>e.toString(36)).join("");return o[e]=t,t},d=async(e,t,r)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},(0,i.encodeBytes)(`${e}:${t}:${r}`)),{name:s},!1,["encrypt","decrypt"]),h=async(e,t)=>{let r=crypto.getRandomValues(new Uint8Array(16));return r.join(",")+"$"+a(await crypto.subtle.encrypt({name:s,iv:r},await e,(0,i.encodeBytes)(t)))},c=async(e,t)=>{let[r,n]=t.split("$");return(0,i.decodeBytes)(await crypto.subtle.decrypt({name:s,iv:new Uint8Array(r.split(","))},await e,l(n)))}}),n("5tvWL",function(t,r){e(t.exports,"libName",function(){return n}),e(t.exports,"alloc",function(){return i}),e(t.exports,"genId",function(){return o}),e(t.exports,"selfId",function(){return a}),e(t.exports,"all",function(){return l}),e(t.exports,"isBrowser",function(){return u}),e(t.exports,"entries",function(){return d}),e(t.exports,"fromEntries",function(){return h}),e(t.exports,"keys",function(){return c}),e(t.exports,"noOp",function(){return f}),e(t.exports,"mkErr",function(){return p}),e(t.exports,"encodeBytes",function(){return y}),e(t.exports,"decodeBytes",function(){return b}),e(t.exports,"toHex",function(){return _}),e(t.exports,"topicPath",function(){return x}),e(t.exports,"getRelays",function(){return w}),e(t.exports,"toJson",function(){return v}),e(t.exports,"fromJson",function(){return E}),e(t.exports,"makeSocket",function(){return C}),e(t.exports,"socketGetter",function(){return T});let n="Trystero",i=(e,t)=>Array(e).fill().map(t),s="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",o=e=>i(e,()=>s[Math.floor(Math.random()*s.length)]).join(""),a=o(20),l=Promise.all.bind(Promise),u="undefined"!=typeof window,{entries:d,fromEntries:h,keys:c}=Object,f=()=>{},p=e=>Error(`${n}: ${e}`),m=new TextEncoder,g=new TextDecoder,y=e=>m.encode(e),b=e=>g.decode(e),_=e=>e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),x=(...e)=>e.join("@"),w=(e,t,r)=>(e.relayUrls||t).slice(0,e.relayUrls?e.relayUrls.length:e.relayRedundancy||r),v=JSON.stringify,E=JSON.parse,S={},C=(e,t)=>{let r={},n=()=>{let i=new WebSocket(e);i.onclose=()=>{S[e]??=3333,setTimeout(n,S[e]),S[e]*=2},i.onmessage=e=>t(e.data),r.socket=i,r.url=i.url,r.ready=new Promise(t=>i.onopen=()=>{t(r),S[e]=3333}),r.send=e=>{1===i.readyState&&i.send(e)}};return n(),r},T=e=>()=>h(d(e).map(([e,t])=>[e,t.socket]))}),n("hZk0n",function(t,n){e(t.exports,"default",function(){return l});var i=r("90InX"),s=r("5tvWL");let o="data",a="signal";var l=(e,t)=>{let r=new i.default({iceServers:[{urls:u}],...t,initiator:e,trickle:!1}),n=e=>s.push(e),s=[];return r.on(o,n),{id:r._id,created:Date.now(),connection:r._pc,get channel(){return r._channel},get isDead(){return r.destroyed},signal:t=>new Promise(n=>{e||r.on(a,n),r.signal(t)}),sendData:e=>r.send(e),destroy:()=>r.destroy(),setHandlers:e=>Object.entries(e).forEach(([e,t])=>r.on(e,t)),offerPromise:e?new Promise(e=>r.on(a,e)):Promise.resolve(),addStream:e=>r.addStream(e),removeStream:e=>r.removeStream(e),addTrack:(e,t)=>r.addTrack(e,t),removeTrack:(e,t)=>r.removeTrack(e,t),replaceTrack:(e,t,n)=>r.replaceTrack(e,t,n),drainEarlyData:e=>{r.off(o,n),s.forEach(e),s=null}}};let u=[...(0,s.alloc)(5,(e,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"]}),n("90InX",function(n,i){e(n.exports,"default",function(){return l});/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var s=r("fRWIU"),o=r("h2yUk");class a extends s.default{constructor(e={}){if(super(e),!this._pc)return;this.streams=e.streams||(e.stream?[e.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)}}addTransceiver(e,r){if(!this._destroying){if(this.destroyed)throw t(o)(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,r),this._needsNegotiation()}catch(e){this.__destroy(t(o)(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:r}})}}addStream(e){if(!this._destroying){if(this.destroyed)throw t(o)(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,r){if(this._destroying)return;if(this.destroyed)throw t(o)(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");let n=this._senderMap.get(e)||new Map,i=n.get(r);if(i){if(i.removed)throw t(o)(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED");throw t(o)(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}i=this._pc.addTrack(e,r),n.set(r,i),this._senderMap.set(e,n),this._needsNegotiation()}replaceTrack(e,r,n){if(this._destroying)return;if(this.destroyed)throw t(o)(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");let i=this._senderMap.get(e),s=i?i.get(n):null;if(!s)throw t(o)(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");r&&this._senderMap.set(r,i),null!=s.replaceTrack?s.replaceTrack(r):this.__destroy(t(o)(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,r){if(this._destroying)return;if(this.destroyed)throw t(o)(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");let n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw t(o)(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(i):this.__destroy(t(o)(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this._destroying){if(this.destroyed)throw t(o)(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some(e=>e.id===t.id)||(this._remoteStreams.push(t),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",t)}))})}}var l=a}),n("fRWIU",function(n,i){e(n.exports,"default",function(){return f});/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var s=r("jSPFS"),o=r("bPVcT"),a=r("9KSpt"),l=r("h2yUk"),u=r("6lcFo");let d=t(s)("simple-peer");function h(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}class c extends a.Duplex{_pc;constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this.__objectMode=!!e.objectMode,this._id=(0,u.arr2hex)((0,u.randomBytes)(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||(0,u.arr2hex)((0,u.randomBytes)(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||c.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},c.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!o.RTCPeerConnection){if("undefined"==typeof window)throw t(l)(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT");throw t(l)(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT")}this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new o.RTCPeerConnection(this.config)}catch(e){this.__destroy(t(l)(e,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch(e=>{this.__destroy(t(l)(e,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw t(l)(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new o.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(e=>{this._addIceCandidate(e)}),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())}).catch(e=>{this.__destroy(t(l)(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.__destroy(t(l)(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){let r=new o.RTCIceCandidate(e);this._pc.addIceCandidate(r).catch(e=>{!r.address||r.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):this.__destroy(t(l)(e,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw t(l)(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw t(l)(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,t){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",t&&(t.message||t)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(t(l)(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{let r=e.error instanceof Error?e.error:Error(`Datachannel error: ${e.message} ${e.filename}:${e.lineno}:${e.colno}`);this.__destroy(t(l)(r,"ERR_DATA_CHANNEL"))};let r=!1;this._closingInterval=setInterval(()=>{this._channel&&"closing"===this._channel.readyState?(r&&this._onChannelClose(),r=!0):r=!1},5e3)}_write(e,r){if(this.destroyed)return r(t(l)(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.__destroy(t(l)(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;let e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){!this.destroyed&&(this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout)))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);let r=()=>{if(this.destroyed)return;let t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})};this._pc.setLocalDescription(e).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))}).catch(e=>{this.__destroy(t(l)(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.__destroy(t(l)(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=h(e.sdp)),e.sdp=this.sdpTransform(e.sdp);let r=()=>{if(this.destroyed)return;let t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers?.()};this._pc.setLocalDescription(e).then(()=>{this.destroyed||(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))}).catch(e=>{this.__destroy(t(l)(e,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(e=>{this.__destroy(t(l)(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||"failed"!==this._pc.connectionState||this.__destroy(t(l)(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;let e=this._pc.iceConnectionState,r=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,r),this.emit("iceStateChange",e,r),("connected"===e||"completed"===e)&&(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.__destroy(t(l)(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.__destroy(t(l)(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){let t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach(t=>{Object.assign(e,t)}),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{let n=[];r.forEach(e=>{n.push(t(e))}),e(null,n)},t=>e(t)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;let n=[];r.result().forEach(e=>{let r={};e.names().forEach(t=>{r[t]=e.stat(t)}),r.id=e.id,r.type=e.type,r.timestamp=e.timestamp,n.push(t(r))}),e(null,n)},t=>e(t)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;let e=()=>{this.destroyed||this._destroying||this.getStats((r,n)=>{if(this.destroyed||this._destroying)return;r&&(n=[]);let i={},s={},o={},a=!1;n.forEach(e=>{("remotecandidate"===e.type||"remote-candidate"===e.type)&&(i[e.id]=e),("localcandidate"===e.type||"local-candidate"===e.type)&&(s[e.id]=e),("candidatepair"===e.type||"candidate-pair"===e.type)&&(o[e.id]=e)});let u=e=>{a=!0;let t=s[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let r=i[e.remoteCandidateId];r&&(r.ip||r.address)?(this.remoteAddress=r.ip||r.address,this.remotePort=Number(r.port)):r&&r.ipAddress?(this.remoteAddress=r.ipAddress,this.remotePort=Number(r.portNumber)):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),this.remoteAddress=r[0],this.remotePort=Number(r[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach(e=>{"transport"===e.type&&e.selectedCandidatePairId&&u(o[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)}),a||Object.keys(o).length&&!Object.keys(s).length)this._connecting=!1,this._connected=!0;else{setTimeout(e,100);return}if(this._chunk){try{this.send(this._chunk)}catch(e){return this.__destroy(t(l)(e,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');let e=this._cb;this._cb=null,e(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>65536)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){!this.destroyed&&(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer?t=new Uint8Array(t):!1===this.__objectMode&&(t=(0,u.text2arr)(t)),this.push(t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);let e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){let e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],d.apply(null,e)}}c.WEBRTC_SUPPORT=!!o.RTCPeerConnection,c.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},c.channelConfig={};var f=c}),n("jSPFS",function(e,t){let n;var i=r("4TNnu");t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==i&&"env"in i&&(e=void 0),e},t.useColors=function(){let e;return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(n=!1,()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r("kNSAH")(t);let{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),n("4TNnu",function(e,t){var r,n,i,s=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u=[],d=!1,h=-1;function c(){d&&i&&(d=!1,i.length?u=i.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=l(c);d=!0;for(var t=u.length;t;){for(i=u,u=[];++h<t;)i&&i[h].run();h=-1,t=u.length}i=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||d||l(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),n("kNSAH",function(e,t){e.exports=function(e){function t(e){let r,i,s;let o=null;function a(...e){if(!a.enabled)return;let n=Number(new Date),i=n-(r||n);a.diff=i,a.prev=r,a.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,n)=>{if("%%"===r)return"%";s++;let i=t.formatters[n];if("function"==typeof i){let t=e[s];r=i.call(a,t),e.splice(s,1),s--}return r}),t.formatArgs.call(a,e),(a.log||t.log).apply(a,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){let n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e,t){let r=0,n=0,i=-1,s=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(i=n,s=r):r++,n++;else{if(-1===i)return!1;n=i+1,r=++s}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){for(let r of(t.save(e),t.namespaces=e,t.names=[],t.skips=[],("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean)))"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(let r of t.skips)if(i(e,r))return!1;for(let r of t.names)if(i(e,r))return!0;return!1},t.humanize=r("fxgme"),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}}),n("fxgme",function(e,t){function r(e,t,r,n){return Math.round(e/r)+" "+n+(t>=1.5*r?"s":"")}e.exports=function(e,t){t=t||{};var n,i,s=typeof e;if("string"===s&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}(e);if("number"===s&&isFinite(e))return t.long?(n=Math.abs(e))>=864e5?r(e,n,864e5,"day"):n>=36e5?r(e,n,36e5,"hour"):n>=6e4?r(e,n,6e4,"minute"):n>=1e3?r(e,n,1e3,"second"):e+" ms":(i=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":i>=36e5?Math.round(e/36e5)+"h":i>=6e4?Math.round(e/6e4)+"m":i>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}),n("bPVcT",function(t,r){e(t.exports,"RTCPeerConnection",function(){return i}),e(t.exports,"RTCSessionDescription",function(){return s}),e(t.exports,"RTCIceCandidate",function(){return o});let n="undefined"!=typeof window?window:self,i=n.RTCPeerConnection||n.mozRTCPeerConnection||n.webkitRTCPeerConnection,s=n.RTCSessionDescription||n.mozRTCSessionDescription||n.webkitRTCSessionDescription,o=n.RTCIceCandidate||n.mozRTCIceCandidate||n.webkitRTCIceCandidate;n.RTCIceTransport,n.RTCDataChannel,n.RTCSctpTransport,n.RTCDtlsTransport,n.RTCCertificate,n.MediaStream,n.MediaStreamTrack,n.MediaStreamTrackEvent,n.RTCPeerConnectionIceEvent,n.RTCDataChannelEvent,n.RTCTrackEvent,n.RTCError,n.RTCErrorEvent,n.RTCRtpTransceiver,n.RTCRtpReceiver,n.RTCRtpSender}),n("9KSpt",function(e,t){var n=r("jMc9N").EventEmitter;let i=Error("Stream was destroyed"),s=Error("Premature close");var o=r("7TI0w"),a=r("jtk9E"),l=r("4pVGN");let u=Symbol.asyncIterator||Symbol("asyncIterator");class d{constructor(e,{highWaterMark:t=16384,map:r=null,mapWritable:n,byteLength:i,byteLengthWritable:s}={}){this.stream=e,this.queue=new a,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=s||i||L,this.map=n||r,this.afterWrite=y.bind(this),this.afterUpdateNextTick=x.bind(this)}get ended(){return(8388608&this.stream._duplexState)!=0}push(e){return(0x880000e&this.stream._duplexState)==0&&((null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark)?(this.stream._duplexState|=2097152,!0):(this.stream._duplexState|=6291456,!1))}shift(){let e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=0x1fdfffff),e}end(e){"function"==typeof e?this.stream.once("finish",e):null!=e&&this.push(e),this.stream._duplexState=(0x8000000|this.stream._duplexState)&0x1fefffff}autoBatch(e,t){let r=[],n=this.stream;for(r.push(e);(0x1024000f&n._duplexState)==2359296;)r.push(n._writableState.shift());if((15&n._duplexState)!=0)return t(null);n._writev(r,t)}update(){let e=this.stream;e._duplexState|=524288;do{for(;(0x1024000f&e._duplexState)==2097152;){let t=this.shift();e._duplexState|=0x4040000,e._write(t,this.afterWrite)}(1310720&e._duplexState)==0&&this.updateNonPrimary()}while(!0===this.continueUpdate())e._duplexState&=0x1ff7ffff}updateNonPrimary(){let e=this.stream;if((0x8a4000f&e._duplexState)==0x8000000){e._duplexState=262144|e._duplexState,e._final(m.bind(this));return}if((14&e._duplexState)==4){(0x2008000&e._duplexState)==0&&(e._duplexState|=262160,e._destroy(g.bind(this)));return}(0x200800f&e._duplexState)==1&&(e._duplexState=(262160|e._duplexState)&0x1ffffffe,e._open(w.bind(this)))}continueUpdate(){return(0x2000000&this.stream._duplexState)!=0&&(this.stream._duplexState&=0x1dffffff,!0)}updateCallback(){(0x218000f&this.stream._duplexState)==1048576?this.update():this.updateNextTick()}updateNextTick(){(0x2000000&this.stream._duplexState)==0&&(this.stream._duplexState|=0x2000000,(524288&this.stream._duplexState)==0&&o(this.afterUpdateNextTick))}}class h{constructor(e,{highWaterMark:t=16384,map:r=null,mapReadable:n,byteLength:i,byteLengthReadable:s}={}){this.stream=e,this.queue=new a,this.highWaterMark=0===t?1:t,this.buffered=0,this.readAhead=t>0,this.error=null,this.pipeline=null,this.byteLength=s||i||L,this.map=n||r,this.pipeTo=null,this.afterRead=b.bind(this),this.afterUpdateNextTick=_.bind(this)}get ended(){return(16384&this.stream._duplexState)!=0}pipe(e,t){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new f(this.stream,e,t),t&&this.stream.on("error",P),N(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",P),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{let t=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",p.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){let t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=(1024|t._duplexState)&0x1ffeffbf,!1):(null!==this.map&&null===(e=this.map(e))?t._duplexState&=0x1ffeffff:(this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=(128|t._duplexState)&0x1ffeffff),this.buffered<this.highWaterMark)}shift(){let e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=0x1fffdf7f),e}unshift(e){let t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){let r=t[e];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){let e=this.stream;if((16527&e._duplexState)==128){let t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=0x1ffffcff),(2048&e._duplexState)!=0&&e.emit("data",t),t}return!1===this.readAhead&&(e._duplexState|=131072,this.updateNextTick()),null}drain(){let e=this.stream;for(;(16527&e._duplexState)==128&&(768&e._duplexState)!=0;){let t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=0x1ffffcff),(2048&e._duplexState)!=0&&e.emit("data",t)}}update(){let e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&e._duplexState)==131072;)e._duplexState|=65552,e._read(this.afterRead),this.drain();(12431&e._duplexState)==4224&&(e._duplexState|=8192,e.emit("readable")),(80&e._duplexState)==0&&this.updateNonPrimary()}while(!0===this.continueUpdate())e._duplexState&=0x1fffffdf}updateNonPrimary(){let e=this.stream;if((1167&e._duplexState)==1024&&(e._duplexState=(16384|e._duplexState)&0x1ffffbff,e.emit("end"),(8405006&e._duplexState)==8404992&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),(14&e._duplexState)==4){(0x2008000&e._duplexState)==0&&(e._duplexState|=262160,e._destroy(g.bind(this)));return}(0x200800f&e._duplexState)==1&&(e._duplexState=(262160|e._duplexState)&0x1ffffffe,e._open(w.bind(this)))}continueUpdate(){return(32768&this.stream._duplexState)!=0&&(this.stream._duplexState&=0x1fff7fff,!0)}updateCallback(){(32879&this.stream._duplexState)==64?this.update():this.updateNextTick()}updateNextTick(){(32768&this.stream._duplexState)==0&&(this.stream._duplexState|=32768,(32&this.stream._duplexState)==0&&o(this.afterUpdateNextTick))}}class c{constructor(e){this.data=null,this.afterTransform=v.bind(e),this.afterFinal=null}}class f{constructor(e,t,r){this.from=e,this.to=t,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){if(t&&(this.error=t),e===this.to&&(this.to=null,null!==this.from)){(16384&this.from._duplexState)!=0&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"));return}if(e===this.from&&(this.from=null,null!==this.to)){(16384&e._duplexState)==0&&this.to.destroy(this.error||Error("Readable stream closed before ending"));return}null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function p(){this.stream._duplexState|=512,this.updateCallback()}function m(e){let t=this.stream;e&&t.destroy(e),(14&t._duplexState)==0&&(t._duplexState|=8388608,t.emit("finish")),(8405006&t._duplexState)==8404992&&(t._duplexState|=4),t._duplexState&=0x17fbffff,(524288&t._duplexState)==0?this.update():this.updateNextTick()}function g(e){let t=this.stream;e||this.error===i||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");let r=t._readableState,n=t._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(t,e),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(t,e)}}function y(e){let t=this.stream;e&&t.destroy(e),t._duplexState&=0x1bfbffff,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),(6553615&t._duplexState)==4194304&&(t._duplexState&=0x1fbfffff,(0x1000000&t._duplexState)==0x1000000&&t.emit("drain")),this.updateCallback()}function b(e){e&&this.stream.destroy(e),this.stream._duplexState&=0x1fffffef,!1===this.readAhead&&(256&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1ffdffff),this.updateCallback()}function _(){(32&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1fff7fff,this.update())}function x(){(524288&this.stream._duplexState)==0&&(this.stream._duplexState&=0x1dffffff,this.update())}function w(e){let t=this.stream;e&&t.destroy(e),(4&t._duplexState)==0&&((17423&t._duplexState)==0&&(t._duplexState|=64),(0x880000f&t._duplexState)==0&&(t._duplexState|=1048576),t.emit("open")),t._duplexState&=0x1ffbffef,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function v(e,t){null!=t&&this.push(t),this._writableState.afterWrite(e)}function E(e){null!==this._readableState&&("data"===e&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=4096,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=0x1000000,this._writableState.updateNextTick())}class S extends n{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",F.bind(this))),this.on("newListener",E)}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return(8&this._duplexState)!=0}get destroying(){return(14&this._duplexState)!=0}destroy(e){(14&this._duplexState)==0&&(e||(e=i),this._duplexState=(4|this._duplexState)&0x1fefffbf,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=0x1ffffffd,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class C extends S{constructor(e){super(e),this._duplexState|=8519681,this._readableState=new h(this,e),e&&(!1===this._readableState.readAhead&&(this._duplexState&=0x1ffdffff),e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick(),e.encoding&&this.setEncoding(e.encoding))}setEncoding(e){let t=new l(e),r=this._readableState.map||O;return this._readableState.map=function(e){let n=t.push(e);return""===n&&(0!==e.byteLength||t.remaining>0)?null:r(n)},this}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=131328,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?0x1ffdfeff:0x1ffffeff,this}static _fromAsyncIterator(e,t){let r;let n=new C({...t,read(t){e.next().then(i).then(t.bind(null,null)).catch(t)},predestroy(){r=e.return()},destroy(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}});return n;function i(e){e.done?n.push(null):n.push(e.value)}}static from(e,t){var r;if(N(r=e)&&r.readable)return e;if(e[u])return this._fromAsyncIterator(e[u](),t);Array.isArray(e)||(e=void 0===e?[]:[e]);let n=0;return new C({...t,read(t){this.push(n===e.length?null:e[n++]),t(null)}})}static isBackpressured(e){return(17422&e._duplexState)!=0||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return(256&e._duplexState)==0}[u](){let e=this,t=null,r=null,n=null;return this.on("error",e=>{t=e}),this.on("readable",function(){null!==r&&s(e.read())}),this.on("close",function(){null!==r&&s(null)}),{[u](){return this},next:()=>new Promise(function(t,i){r=t,n=i;let o=e.read();null!==o?s(o):(8&e._duplexState)!=0&&s(null)}),return:()=>o(null),throw:e=>o(e)};function s(s){null!==n&&(t?n(t):null===s&&(16384&e._duplexState)==0?n(i):r({value:s,done:null===s}),n=r=null)}function o(t){return e.destroy(t),new Promise((r,n)=>{if(8&e._duplexState)return r({value:void 0,done:!0});e.once("close",function(){t?n(t):r({value:void 0,done:!0})})})}}}class T extends S{constructor(e){super(e),this._duplexState|=16385,this._writableState=new d(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=0x10000000}uncork(){this._duplexState&=0xfffffff,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return(0x8c0000e&e._duplexState)!=0}static drained(e){if(e.destroyed)return Promise.resolve(!1);let t=e._writableState,r=(e._writev!==T.prototype._writev&&e._writev!==k.prototype._writev?Math.min(1,t.queue.length):t.queue.length)+(0x4000000&e._duplexState?1:0);return 0===r?Promise.resolve(!0):(null===t.drains&&(t.drains=[]),new Promise(e=>{t.drains.push({writes:r,resolve:e})}))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class k extends C{constructor(e){super(e),this._duplexState=1|131072&this._duplexState,this._writableState=new d(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}cork(){this._duplexState|=0x10000000}uncork(){this._duplexState&=0xfffffff,this._writableState.updateNextTick()}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class A extends k{constructor(e){super(e),this._transformState=new c(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(null!==this._transformState.data){let t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}destroy(e){super.destroy(e),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(R.bind(this))}}function R(e,t){let r=this._transformState.afterFinal;if(e)return r(e);null!=t&&this.push(t),this.push(null),r(null)}function B(e,...t){let r=Array.isArray(e)?[...e,...t]:[e,...t],n=r.length&&"function"==typeof r[r.length-1]?r.pop():null;if(r.length<2)throw Error("Pipeline requires at least 2 streams");let i=r[0],o=null,a=null;for(let e=1;e<r.length;e++)o=r[e],N(i)?i.pipe(o,l):(function(e,t,r,n){e.on("error",n),e.on("close",function(){if(t&&e._readableState&&!e._readableState.ended||r&&e._writableState&&!e._writableState.ended)return n(s)})}(i,!0,e>1,l),i.pipe(o)),i=o;if(n){let e=!1,t=N(o)||!!(o._writableState&&o._writableState.autoDestroy);o.on("error",e=>{null===a&&(a=e)}),o.on("finish",()=>{e=!0,t||n(a)}),t&&o.on("close",()=>n(a||(e?null:s)))}return o;function l(e){if(e&&!a)for(let t of(a=e,r))t.destroy(e)}}function O(e){return e}function I(e){return!!e._readableState||!!e._writableState}function N(e){return"number"==typeof e._duplexState&&I(e)}function L(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength?e.byteLength:1024}function P(){}function F(){this.destroy(Error("Stream aborted."))}e.exports={pipeline:B,pipelinePromise:function(...e){return new Promise((t,r)=>B(...e,e=>{if(e)return r(e);t()}))},isStream:I,isStreamx:N,isDisturbed:function(e){return(2228495&e._duplexState)!=1},isEnded:function(e){return!!e._readableState&&e._readableState.ended},isFinished:function(e){return!!e._writableState&&e._writableState.ended},getStreamError:function(e,t={}){let r=e._readableState&&e._readableState.error||e._writableState&&e._writableState.error;return t.all||r!==i?r:null},Stream:S,Writable:T,Readable:C,Duplex:k,Transform:A,PassThrough:class extends A{}}}),n("jMc9N",function(e,t){var r,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(r,n){var i;function s(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&(i={once:!0},"function"==typeof e.on&&g(e,"error",s,i))})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){if(l(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var i,s,o,a=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var o,a=Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else for(var u=l.length,d=m(l,u),r=0;r<u;++r)i(d[r],this,t);return!0},o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){return l(t),this.on(e,c(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,c(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,s,o;if(l(t),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}}),n("7TI0w",function(e,t){e.exports="function"==typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)}),n("jtk9E",function(e,t){var n=r("dcWDZ");e.exports=class{constructor(e){this.hwm=e||16,this.head=new n(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){let t=this.head;this.head=t.next=new n(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;let e=this.tail.shift();if(void 0===e&&this.tail.next){let e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){let e=this.tail.peek();return void 0===e&&this.tail.next?this.tail.next.peek():e}isEmpty(){return 0===this.length}}}),n("dcWDZ",function(e,t){e.exports=class{constructor(e){if(!(e>0)||(e-1&e)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}}),n("4pVGN",function(e,t){var n=(r("6QxrA"),r("6QxrA"));e.exports=class{constructor(e="utf8"){switch(this.encoding=function(e){switch(e=e.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:throw Error("Unknown encoding: "+e)}}(e),this.encoding){case"utf8":this.decoder=new n;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new n(this.encoding)}}get remaining(){return this.decoder.remaining}push(e){return"string"==typeof e?e:this.decoder.decode(e)}write(e){return this.push(e)}end(e){let t="";return e&&(t=this.push(e)),t+=this.decoder.flush()}}}),n("6QxrA",function(e,t){e.exports=class{constructor(e){this.decoder=new TextDecoder("utf16le"===e?"utf16-le":e)}get remaining(){return -1}decode(e){return this.decoder.decode(e,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}}}),n("h2yUk",function(e,t){function r(e,t){for(let r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}e.exports=function(e,t,n){if(!e||"string"==typeof e)throw TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof t&&(n=t,t=""),t&&(n.code=t);try{return r(e,n)}catch(i){n.message=e.message,n.stack=e.stack;let t=function(){};return t.prototype=Object.create(Object.getPrototypeOf(e)),r(new t,n)}}}),n("6lcFo",function(t,n){e(t.exports,"text2arr",function(){return o}),e(t.exports,"randomBytes",function(){return u});var i=r("gO9Ze");r("4udE8"),new TextDecoder;let s=new TextEncoder,o=e=>s.encode(e),a="undefined"!=typeof window?window:self,l=a.crypto||a.msCrypto||{};l.subtle||l.webkitSubtle,i.arr2hex;let u=e=>{let t=new Uint8Array(e);return l.getRandomValues(t)}}),n("gO9Ze",function(t,r){e(t.exports,"alphabet",function(){return n}),e(t.exports,"arr2hex",function(){return o}),e(t.exports,"hex2arr",function(){return a});/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/let n="0123456789abcdef",i=[],s=[];for(let e=0;e<256;e++)i[e]=n[e>>4&15]+n[15&e],e<16&&(e<10?s[48+e]=e:s[87+e]=e);let o=e=>{let t=e.length,r="",n=0;for(;n<t;)r+=i[e[n++]];return r},a=e=>{let t=e.length>>1,r=t<<1,n=new Uint8Array(t),i=0,o=0;for(;o<r;)n[i++]=s[e.charCodeAt(o++)]<<4|s[e.charCodeAt(o++)];return n}}),n("4udE8",function(t,r){e(t.exports,"encode",function(){return o}),e(t.exports,"decode",function(){return a});for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="undefined"==typeof Uint8Array?[]:new Uint8Array(256),s=0;s<n.length;s++)i[n.charCodeAt(s)]=s;var o=function(e){var t,r=new Uint8Array(e),i=r.length,s="";for(t=0;t<i;t+=3)s+=n[r[t]>>2],s+=n[(3&r[t])<<4|r[t+1]>>4],s+=n[(15&r[t+1])<<2|r[t+2]>>6],s+=n[63&r[t+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},a=function(e){var t,r,n,s,o,a=.75*e.length,l=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),h=new Uint8Array(d);for(t=0;t<l;t+=4)r=i[e.charCodeAt(t)],n=i[e.charCodeAt(t+1)],s=i[e.charCodeAt(t+2)],o=i[e.charCodeAt(t+3)],h[u++]=r<<2|n>>4,h[u++]=(15&n)<<4|s>>2,h[u++]=(3&s)<<6|63&o;return d}}),n("9cqsZ",function(t,n){e(t.exports,"default",function(){return l});var i=r("5tvWL");let s=Object.getPrototypeOf(Uint8Array),o="bufferedamountlow",a=e=>"@_"+e;var l=(e,t,r)=>{let n={},l={},u={},d={},h={},c={},f={},p={onPeerJoin:i.noOp,onPeerLeave:i.noOp,onPeerStream:i.noOp,onPeerTrack:i.noOp},m=(e,t)=>(e?Array.isArray(e)?e:[e]:(0,i.keys)(n)).flatMap(e=>{let r=n[e];return r?t(e,r):(console.warn(`${i.libName}: no peer with id ${e} found`),[])}),g=e=>{n[e]&&(delete n[e],delete d[e],delete h[e],p.onPeerLeave(e),t(e))},y=e=>{if(l[e])return u[e];if(!e)throw(0,i.mkErr)("action type argument is required");let t=(0,i.encodeBytes)(e);if(t.byteLength>12)throw(0,i.mkErr)(`action type string "${e}" (${t.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);let r=new Uint8Array(12);r.set(t);let a=0;return l[e]={onComplete:i.noOp,onProgress:i.noOp,setOnComplete:t=>l[e]={...l[e],onComplete:t},setOnProgress:t=>l[e]={...l[e],onProgress:t},send:async(e,t,l,u)=>{if(l&&"object"!=typeof l)throw(0,i.mkErr)("action meta argument must be an object");let d=typeof e;if("undefined"===d)throw(0,i.mkErr)("action data cannot be undefined");let h="string"!==d,c=e instanceof Blob,f=c||e instanceof ArrayBuffer||e instanceof s;if(l&&!f)throw(0,i.mkErr)("action meta argument can only be used with binary data");let p=f?new Uint8Array(c?await e.arrayBuffer():e):(0,i.encodeBytes)(h?(0,i.toJson)(e):e),g=l?(0,i.encodeBytes)((0,i.toJson)(l)):null,y=Math.ceil(p.byteLength/16369)+(l?1:0)||1,b=(0,i.alloc)(y,(e,t)=>{let n=t===y-1,i=l&&0===t,s=new Uint8Array(15+(i?g.byteLength:n?p.byteLength-16369*(y-(l?2:1)):16369));return s.set(r),s.set([a],12),s.set([n|i<<1|f<<2|h<<3],13),s.set([Math.round((t+1)/y*255)],14),s.set(l?i?g:p.subarray((t-1)*16369,16369*t):p.subarray(16369*t,(t+1)*16369),15),s});return a=a+1&255,(0,i.all)(m(t,async(e,t)=>{let{channel:r}=t,i=0;for(;i<y;){let s=b[i];if(r.bufferedAmount>r.bufferedAmountLowThreshold&&await new Promise(e=>{let t=()=>{r.removeEventListener(o,t),e()};r.addEventListener(o,t)}),!n[e])break;t.sendData(s),i++,u?.(s[14]/255,e,l)}}))}},u[e]||=[l[e].send,l[e].setOnComplete,l[e].setOnProgress]},b=(e,t)=>{let r=new Uint8Array(t),n=(0,i.decodeBytes)(r.subarray(0,12)).replaceAll("\0",""),[s]=r.subarray(12,13),[o]=r.subarray(13,14),[a]=r.subarray(14,15),u=r.subarray(15);if(!l[n]){console.warn(`${i.libName}: received message with unregistered type (${n})`);return}d[e]||={},d[e][n]||={};let h=d[e][n][s]||={chunks:[]};if(2&o?h.meta=(0,i.fromJson)((0,i.decodeBytes)(u)):h.chunks.push(u),l[n].onProgress(a/255,e,h.meta),!(1&o))return;let c=new Uint8Array(h.chunks.reduce((e,t)=>e+t.byteLength,0));if(h.chunks.reduce((e,t)=>(c.set(t,e),e+t.byteLength),0),delete d[e][n][s],4&o)l[n].onComplete(c,e,h.meta);else{let t=(0,i.decodeBytes)(c);l[n].onComplete(8&o?(0,i.fromJson)(t):t,e)}},_=async()=>{await B(""),await new Promise(e=>setTimeout(e,99)),(0,i.entries)(n).forEach(([e,t])=>{t.destroy(),delete n[e]}),r()},[x,w]=y(a("ping")),[v,E]=y(a("pong")),[S,C]=y(a("signal")),[T,k]=y(a("stream")),[A,R]=y(a("track")),[B,O]=y(a("leave"));return e((e,t)=>{n[t]||(n[t]=e,e.setHandlers({data:e=>b(t,e),stream:e=>{p.onPeerStream(e,t,c[t]),delete c[t]},track:(e,r)=>{p.onPeerTrack(e,r,t,f[t]),delete f[t]},signal:e=>S(e,t),close:()=>g(t),error:()=>g(t)}),p.onPeerJoin(t),e.drainEarlyData?.(e=>b(t,e)))}),w((e,t)=>v("",t)),E((e,t)=>{h[t]?.(),delete h[t]}),C((e,t)=>n[t]?.signal(e)),k((e,t)=>c[t]=e),R((e,t)=>f[t]=e),O((e,t)=>g(t)),i.isBrowser&&addEventListener("beforeunload",_),{makeAction:y,leave:_,ping:async e=>{if(!e)throw(0,i.mkErr)("ping() must be called with target peer ID");let t=Date.now();return x("",e),await new Promise(t=>h[e]=t),Date.now()-t},getPeers:()=>(0,i.fromEntries)((0,i.entries)(n).map(([e,t])=>[e,t.connection])),addStream:(e,t,r)=>m(t,async(t,n)=>{r&&await T(r,t),n.addStream(e)}),removeStream:(e,t)=>m(t,(t,r)=>r.removeStream(e)),addTrack:(e,t,r,n)=>m(r,async(r,i)=>{n&&await A(n,r),i.addTrack(e,t)}),removeTrack:(e,t,r)=>m(r,(r,n)=>n.removeTrack(e,t)),replaceTrack:(e,t,r,n,i)=>m(n,async(n,s)=>{i&&await A(i,n),s.replaceTrack(e,t,r)}),onPeerJoin:e=>p.onPeerJoin=e,onPeerLeave:e=>p.onPeerLeave=e,onPeerStream:e=>p.onPeerStream=e,onPeerTrack:e=>p.onPeerTrack=e}}});
//# sourceMappingURL=trystero.566d5c04.js.map
